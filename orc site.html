<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Orcmondo Live</title>
  <meta name="description" content="Watch Orcmondo live on Twitch with chat, status, and an orc-themed layout." />

  <style>
    :root{
      --bg:#070b08;
      --panel:#0f1712;
      --panel2:#0b120e;
      --text:#e7f5ea;
      --muted:#a7c6b1;
      --green:#34ff7a;
      --green2:#16c25a;
      --red:#ff375f;
      --line:rgba(52,255,122,.22);
      --shadow: 0 10px 40px rgba(0,0,0,.55);
      --radius:18px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(900px 600px at 20% 10%, rgba(52,255,122,.10), transparent 60%),
        radial-gradient(700px 500px at 85% 20%, rgba(22,194,90,.10), transparent 55%),
        linear-gradient(180deg, #050805 0%, #060a07 60%, #050805 100%);
      color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow-x:hidden;
    }

    /* Subtle “orc rune” grid */
    body:before{
      content:"";
      position:fixed; inset:0;
      background-image:
        linear-gradient(to right, rgba(52,255,122,.06) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(52,255,122,.04) 1px, transparent 1px);
      background-size: 90px 90px;
      opacity:.22;
      pointer-events:none;
      mix-blend-mode: screen;
    }

    .wrap{
      max-width: 1500px;
      margin: 18px auto;
      padding: 14px;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 14px 14px 10px;
      border: 1px solid var(--line);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(15,23,18,.95), rgba(11,18,14,.92));
      box-shadow: var(--shadow);
      position: sticky;
      top: 10px;
      z-index: 10;
      backdrop-filter: blur(10px);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 240px;
    }

    .logo{
      width:44px;height:44px;
      border-radius: 14px;
      border:1px solid rgba(52,255,122,.35);
      background:
        radial-gradient(circle at 30% 30%, rgba(52,255,122,.35), transparent 55%),
        linear-gradient(135deg, rgba(52,255,122,.18), rgba(0,0,0,.0));
      display:grid; place-items:center;
      box-shadow: 0 8px 20px rgba(0,0,0,.35);
      overflow:hidden;
    }
    .logo svg{opacity:.95}

    .title{
      display:flex;
      flex-direction:column;
      line-height:1.05;
    }
    .title .name{
      font-weight:800;
      letter-spacing:.5px;
      font-size: 18px;
    }
    .title .tag{
      color:var(--muted);
      font-size: 12px;
      margin-top: 3px;
    }

    .status{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(52,255,122,.22);
      background: rgba(0,0,0,.18);
      min-width: 260px;
      justify-content:space-between;
    }
    .status-left{
      display:flex; align-items:center; gap:10px;
    }
    .dot{
      width:10px;height:10px;border-radius:999px;
      background: rgba(167,198,177,.7);
      box-shadow: 0 0 0 0 rgba(52,255,122,0);
      animation: none;
    }
    .dot.live{
      background: var(--red);
      box-shadow: 0 0 0 0 rgba(255,55,95,.6);
      animation: pulse 1.2s infinite;
    }
    @keyframes pulse{
      0%{ box-shadow:0 0 0 0 rgba(255,55,95,.6) }
      70%{ box-shadow:0 0 0 10px rgba(255,55,95,0) }
      100%{ box-shadow:0 0 0 0 rgba(255,55,95,0) }
    }
    .status-text{
      display:flex; flex-direction:column; gap:2px;
    }
    .status-text b{font-size: 12px}
    .status-text span{font-size: 11px; color: var(--muted)}
    .status-actions{
      display:flex; gap:8px; align-items:center;
    }

    .btn{
      border: 1px solid rgba(52,255,122,.25);
      background: rgba(0,0,0,.22);
      color: var(--text);
      padding: 9px 10px;
      border-radius: 12px;
      cursor:pointer;
      font-weight:700;
      font-size: 12px;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(52,255,122,.45); background: rgba(0,0,0,.28) }
    .btn.primary{
      border-color: rgba(52,255,122,.55);
      background: linear-gradient(180deg, rgba(52,255,122,.18), rgba(0,0,0,.18));
    }
    .btn.danger{
      border-color: rgba(255,55,95,.55);
      background: linear-gradient(180deg, rgba(255,55,95,.14), rgba(0,0,0,.18));
    }

    .grid{
      display:grid;
      grid-template-columns: 1.9fr 1.1fr;
      gap: 14px;
      margin-top: 14px;
    }

    .card{
      border: 1px solid var(--line);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(15,23,18,.94), rgba(11,18,14,.90));
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }

    .card-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 12px 12px 10px;
      border-bottom: 1px solid rgba(52,255,122,.14);
      background: linear-gradient(180deg, rgba(0,0,0,.12), rgba(0,0,0,.0));
    }
    .card-head h2{
      margin:0;
      font-size: 13px;
      letter-spacing:.4px;
      text-transform: uppercase;
      color: rgba(231,245,234,.92);
    }

    .player-wrap{
      position:relative;
      width:100%;
      aspect-ratio: 16/9;
      background: #000;
    }
    #twitch-embed{
      position:absolute; inset:0;
    }

    .overlay-offline{
      position:absolute; inset:0;
      display:none;
      align-items:center; justify-content:center;
      flex-direction:column;
      gap:10px;
      padding: 20px;
      text-align:center;
      background: radial-gradient(600px 300px at 50% 25%, rgba(255,55,95,.10), transparent 60%),
                  rgba(0,0,0,.55);
      backdrop-filter: blur(8px);
    }
    .overlay-offline.show{display:flex}
    .overlay-offline .big{
      font-size: 18px;
      font-weight: 900;
      letter-spacing:.5px;
    }
    .overlay-offline .small{
      font-size: 12px;
      color: var(--muted);
      max-width: 520px;
    }

    .controls{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      padding: 12px;
      border-top: 1px solid rgba(52,255,122,.14);
    }

    .pill{
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid rgba(52,255,122,.20);
      background: rgba(0,0,0,.18);
      cursor:pointer;
      font-weight:800;
      font-size: 12px;
      transition: transform .12s ease, border-color .12s ease;
      user-select:none;
    }
    .pill:hover{ transform: translateY(-1px); border-color: rgba(52,255,122,.45) }
    .pill.active{
      border-color: rgba(52,255,122,.65);
      background: rgba(52,255,122,.12);
    }

    .chat-wrap{
      height: calc(100vh - 160px);
      min-height: 520px;
    }
    #chat-frame{
      width:100%;
      height:100%;
      border:0;
      background:#000;
    }

    .chat-collapsed .chat-wrap{ display:none; }
    .chat-collapsed .grid{ grid-template-columns: 1fr; }

    /* Multi-stream grid */
    .multistream{
      display:none;
      padding: 12px;
      gap:12px;
    }
    .multistream.show{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
    .ms-cell{
      aspect-ratio: 16/9;
      background:#000;
      border-radius: 16px;
      overflow:hidden;
      border:1px solid rgba(52,255,122,.18);
      position:relative;
    }
    .ms-cell iframe{
      position:absolute; inset:0;
      width:100%; height:100%;
      border:0;
    }

    /* Intro overlay */
    .intro{
      position:fixed; inset:0;
      display:grid;
      place-items:center;
      background:
        radial-gradient(900px 500px at 50% 35%, rgba(52,255,122,.18), transparent 60%),
        rgba(0,0,0,.88);
      z-index: 9999;
      opacity:1;
      transition: opacity .9s ease;
    }
    .intro.hide{opacity:0; pointer-events:none}
    .intro-card{
      width:min(720px, 92vw);
      border-radius: 26px;
      border: 1px solid rgba(52,255,122,.28);
      background: linear-gradient(180deg, rgba(15,23,18,.98), rgba(11,18,14,.95));
      box-shadow: 0 24px 80px rgba(0,0,0,.7);
      padding: 22px;
      display:flex;
      align-items:center;
      gap:16px;
    }
    .intro-mark{
      width:64px;height:64px;
      border-radius: 20px;
      border: 1px solid rgba(52,255,122,.45);
      display:grid; place-items:center;
      background:
        radial-gradient(circle at 30% 30%, rgba(52,255,122,.38), transparent 55%),
        linear-gradient(135deg, rgba(52,255,122,.12), rgba(0,0,0,0));
    }
    .intro-text h1{
      margin:0;
      font-size: 22px;
      letter-spacing:.6px;
    }
    .intro-text p{
      margin:6px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }
    .intro-bar{
      margin-top: 12px;
      height: 8px;
      border-radius: 999px;
      background: rgba(52,255,122,.10);
      border: 1px solid rgba(52,255,122,.18);
      overflow:hidden;
    }
    .intro-bar > span{
      display:block;
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(52,255,122,.45), rgba(22,194,90,.25));
      animation: loadbar 1.3s ease forwards;
    }
    @keyframes loadbar{ to { width: 100%; } }

    /* Mobile */
    @media (max-width: 980px){
      header{ position: static; }
      .grid{ grid-template-columns: 1fr; }
      .chat-wrap{ height: 520px; min-height: 520px; }
      .status{ min-width: unset; width:100%; }
      .brand{ min-width: unset; }
      header{ flex-direction: column; align-items: stretch; }
      .status-actions{ justify-content:flex-end; }
    }
    @media (max-width: 520px){
      .status-actions{ flex-wrap:wrap; }
      .intro-card{ flex-direction:column; text-align:center; }
    }
  </style>
</head>

<body>
  <!-- Branding intro overlay -->
  <div class="intro" id="intro">
    <div class="intro-card">
      <div class="intro-mark" aria-hidden="true">
        <!-- Simple rune-like mark -->
        <svg width="34" height="34" viewBox="0 0 24 24" fill="none">
          <path d="M12 2l2.6 5.4L20 10l-5.4 2.6L12 18l-2.6-5.4L4 10l5.4-2.6L12 2z" stroke="rgba(52,255,122,.95)" stroke-width="1.4"/>
          <path d="M12 6v12" stroke="rgba(52,255,122,.65)" stroke-width="1.2"/>
        </svg>
      </div>
      <div class="intro-text">
        <h1>ORCMONDO — ENTERING THE WAAAGH</h1>
        <p>Loading stream + chat. If the embed doesn’t load, make sure the <b>parent</b> domains are set correctly (see CONFIG).</p>
        <div class="intro-bar"><span></span></div>
      </div>
    </div>
  </div>

  <div class="wrap" id="app">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true" title="Orcmondo">
          <svg width="26" height="26" viewBox="0 0 24 24" fill="none">
            <path d="M5 18c2-6 12-6 14 0" stroke="rgba(52,255,122,.92)" stroke-width="1.6" stroke-linecap="round"/>
            <path d="M7 10c0-2 2-4 5-4s5 2 5 4" stroke="rgba(52,255,122,.55)" stroke-width="1.4" stroke-linecap="round"/>
            <path d="M9 14l-2 2M15 14l2 2" stroke="rgba(52,255,122,.55)" stroke-width="1.4" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="title">
          <div class="name">Orcmondo Live</div>
          <div class="tag">What quest will you embark on today?</div>
        </div>
      </div>

      <div class="status" role="status" aria-live="polite">
        <div class="status-left">
          <div class="dot" id="liveDot"></div>
          <div class="status-text">
            <b id="statusTitle">Checking stream status…</b>
            <span id="statusSub">Initializing Twitch player</span>
          </div>
        </div>
        <div class="status-actions">
          <button class="btn primary" id="btnToggleChat" type="button">Toggle Chat</button>
          <button class="btn" id="btnToggleMulti" type="button">Multi-stream</button>
          <button class="btn danger" id="btnOfflineAction" type="button" title="Used when offline">Go to Channel</button>
        </div>
      </div>
    </header>

    <main class="grid">
      <!-- PLAYER -->
      <section class="card">
        <div class="card-head">
          <h2>Stream</h2>
          <div style="display:flex; gap:8px; align-items:center;">
            <span style="color:var(--muted); font-size:12px; font-weight:700;">Now Playing:</span>
            <span id="nowChannel" style="font-size:12px; font-weight:900; letter-spacing:.3px;">orcmondo_</span>
          </div>
        </div>

        <div class="player-wrap">
          <div id="twitch-embed"></div>

          <!-- OFFLINE overlay -->
          <div class="overlay-offline" id="offlineOverlay">
            <div class="big">OFFLINE (for now).</div>
            <div class="small" id="offlineMsg">
              If you’re hosting this on a domain, make sure your Twitch embed “parent” is set correctly.
              You can also auto-redirect to the channel page.
            </div>
            <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
              <button class="btn primary" id="btnRetry" type="button">Retry Player</button>
              <button class="btn danger" id="btnRedirectNow" type="button">Open Twitch Channel</button>
            </div>
          </div>
        </div>

        <!-- Channel selector + settings -->
        <div class="controls" id="channelControls"></div>

        <!-- Multi-stream panel (optional) -->
        <div class="multistream" id="multistreamGrid"></div>
      </section>

      <!-- CHAT -->
      <aside class="card" id="chatCard">
        <div class="card-head">
          <h2>Chat</h2>
          <div style="display:flex; gap:8px; align-items:center;">
            <button class="btn" id="btnPopoutChat" type="button">Popout</button>
          </div>
        </div>
        <div class="chat-wrap">
          <iframe id="chat-frame" title="Twitch Chat"></iframe>
        </div>
      </aside>
    </main>
  </div>

  <!-- Twitch embed JS -->
  <script src="https://player.twitch.tv/js/embed/v1.js"></script>

  <script>
    /***********************
     * CONFIG (EDIT THIS!)
     ***********************/
    const CONFIG = {
      // Your default channel
      defaultChannel: "orcmondo_",

      // Add more channels here for “multi-stream” + quick switching
      channels: [
        "orcmondo_",
        // "orcmondo",        // add more if you want
        // "another_channel",
        // "friend_channel"
      ],

      // REQUIRED: Twitch embed requires a “parent” list that matches your domain(s).
      // For local testing, "localhost" is fine.
      // For hosting, add your domain(s), e.g. ["orcmondo.com", "www.orcmondo.com"] or ["orcmondo.github.io"].
      parentDomains: ["localhost"],

      // Offline behavior:
      offlineRedirectEnabled: true,
      offlineRedirectDelayMs: 9000, // set 0 to disable delay (still uses button)
      offlineRedirectUrl: (channel) => `https://www.twitch.tv/${channel}`,

      // UI defaults
      chatStartsVisible: true,
      multiStreamStartsVisible: false,
    };

    /***********************
     * STATE
     ***********************/
    let currentChannel = CONFIG.defaultChannel;
    let player = null;
    let offlineRedirectTimer = null;

    const els = {
      intro: document.getElementById("intro"),
      app: document.getElementById("app"),
      liveDot: document.getElementById("liveDot"),
      statusTitle: document.getElementById("statusTitle"),
      statusSub: document.getElementById("statusSub"),
      nowChannel: document.getElementById("nowChannel"),
      offlineOverlay: document.getElementById("offlineOverlay"),
      offlineMsg: document.getElementById("offlineMsg"),
      btnRetry: document.getElementById("btnRetry"),
      btnRedirectNow: document.getElementById("btnRedirectNow"),
      btnToggleChat: document.getElementById("btnToggleChat"),
      btnToggleMulti: document.getElementById("btnToggleMulti"),
      btnOfflineAction: document.getElementById("btnOfflineAction"),
      btnPopoutChat: document.getElementById("btnPopoutChat"),
      chatFrame: document.getElementById("chat-frame"),
      chatCard: document.getElementById("chatCard"),
      channelControls: document.getElementById("channelControls"),
      multistreamGrid: document.getElementById("multistreamGrid"),
    };

    /***********************
     * HELPERS
     ***********************/
    function setStatus({ live, title, sub }) {
      els.statusTitle.textContent = title || "";
      els.statusSub.textContent = sub || "";

      if (live) {
        els.liveDot.classList.add("live");
      } else {
        els.liveDot.classList.remove("live");
      }
    }

    function showOfflineOverlay(show) {
      els.offlineOverlay.classList.toggle("show", !!show);
    }

    function clearOfflineRedirect() {
      if (offlineRedirectTimer) {
        clearTimeout(offlineRedirectTimer);
        offlineRedirectTimer = null;
      }
    }

    function scheduleOfflineRedirect() {
      clearOfflineRedirect();
      if (!CONFIG.offlineRedirectEnabled) return;
      const delay = Number(CONFIG.offlineRedirectDelayMs || 0);
      if (delay <= 0) return;

      const url = CONFIG.offlineRedirectUrl(currentChannel);
      els.offlineMsg.textContent =
        `Stream appears offline. Redirecting to the channel page in ${(delay/1000).toFixed(0)}s… ` +
        `You can also switch channels or retry the player.`;

      offlineRedirectTimer = setTimeout(() => {
        window.location.href = url;
      }, delay);
    }

    function buildChatUrl(channel) {
      const parents = CONFIG.parentDomains.map(encodeURIComponent).join("&parent=");
      return `https://www.twitch.tv/embed/${encodeURIComponent(channel)}/chat?parent=${parents}`;
    }

    function buildPlayerEmbed() {
      // Clean container first
      const container = document.getElementById("twitch-embed");
      container.innerHTML = "";

      setStatus({
        live: false,
        title: "Loading player…",
        sub: "If it fails, check parentDomains in CONFIG.",
      });
      showOfflineOverlay(false);
      clearOfflineRedirect();

      player = new Twitch.Player("twitch-embed", {
        channel: currentChannel,
        width: "100%",
        height: "100%",
        parent: CONFIG.parentDomains,
        autoplay: true,
        muted: false
      });

      // Events
      player.addEventListener(Twitch.Player.READY, () => {
        setStatus({
          live: false,
          title: "Player ready",
          sub: "Waiting for online/offline signal…",
        });
      });

      player.addEventListener(Twitch.Player.ONLINE, () => {
        showOfflineOverlay(false);
        clearOfflineRedirect();
        setStatus({
          live: true,
          title: "LIVE — WAAAGH IN PROGRESS",
          sub: `Now streaming: ${currentChannel}`,
        });
      });

      player.addEventListener(Twitch.Player.OFFLINE, () => {
        setStatus({
          live: false,
          title: "OFFLINE",
          sub: `Channel: ${currentChannel}`,
        });
        showOfflineOverlay(true);
        scheduleOfflineRedirect();
      });

      player.addEventListener(Twitch.Player.PLAY, () => {
        // If play starts, assume online-ish
        setStatus({
          live: true,
          title: "PLAYING",
          sub: `Channel: ${currentChannel}`,
        });
        showOfflineOverlay(false);
        clearOfflineRedirect();
      });

      player.addEventListener(Twitch.Player.ERROR, (e) => {
        // Often caused by missing/incorrect parent
        setStatus({
          live: false,
          title: "Embed error",
          sub: "Check CONFIG.parentDomains matches your site domain exactly.",
        });
        showOfflineOverlay(true);
        if (!els.offlineMsg.textContent.includes("parentDomains")) {
          els.offlineMsg.textContent =
            "Embed error. Most common cause: Twitch requires the correct parent domain(s). " +
            "Edit CONFIG.parentDomains to match where you’re hosting this page.";
        }
      });
    }

    function setActiveChannelUI() {
      els.nowChannel.textContent = currentChannel;

      const pills = els.channelControls.querySelectorAll(".pill");
      pills.forEach(p => {
        p.classList.toggle("active", p.dataset.channel === currentChannel);
      });
    }

    function switchChannel(channel) {
      if (!channel || channel === currentChannel) return;
      currentChannel = channel;

      // Update UI
      setActiveChannelUI();

      // Update chat iframe
      els.chatFrame.src = buildChatUrl(currentChannel);

      // Rebuild player
      buildPlayerEmbed();

      // Rebuild multistream tiles too
      buildMultiStreamGrid();
    }

    function buildChannelControls() {
      els.channelControls.innerHTML = "";

      // Channel pills
      CONFIG.channels.forEach(ch => {
        const pill = document.createElement("div");
        pill.className = "pill";
        pill.textContent = ch;
        pill.dataset.channel = ch;
        pill.onclick = () => switchChannel(ch);
        els.channelControls.appendChild(pill);
      });

      // Spacer
      const spacer = document.createElement("div");
      spacer.style.flex = "1";
      els.channelControls.appendChild(spacer);

      // Quick buttons
      const btnChannel = document.createElement("button");
      btnChannel.className = "btn primary";
      btnChannel.type = "button";
      btnChannel.textContent = "Open Channel";
      btnChannel.onclick = () => window.open(CONFIG.offlineRedirectUrl(currentChannel), "_blank", "noopener,noreferrer");
      els.channelControls.appendChild(btnChannel);

      const btnVods = document.createElement("button");
      btnVods.className = "btn";
      btnVods.type = "button";
      btnVods.textContent = "VODs";
      btnVods.onclick = () => window.open(`https://www.twitch.tv/${currentChannel}/videos`, "_blank", "noopener,noreferrer");
      els.channelControls.appendChild(btnVods);

      setActiveChannelUI();
    }

    function buildMultiStreamGrid() {
      // Multi-stream = 2x2 grid of iframes
      // If you only have 1 channel in CONFIG.channels, add more to see this do anything.
      els.multistreamGrid.innerHTML = "";

      const chans = CONFIG.channels.slice(0, 4);
      chans.forEach(ch => {
        const cell = document.createElement("div");
        cell.className = "ms-cell";

        const iframe = document.createElement("iframe");
        const parents = CONFIG.parentDomains.map(encodeURIComponent).join("&parent=");
        iframe.src = `https://player.twitch.tv/?channel=${encodeURIComponent(ch)}&parent=${parents}&muted=true`;
        iframe.allow = "autoplay; fullscreen";
        iframe.title = `Twitch Player — ${ch}`;

        cell.appendChild(iframe);
        els.multistreamGrid.appendChild(cell);
      });
    }

    function setChatVisible(visible) {
      document.body.classList.toggle("chat-collapsed", !visible);
      els.btnToggleChat.textContent = visible ? "Hide Chat" : "Show Chat";
    }

    function setMultiStreamVisible(visible) {
      els.multistreamGrid.classList.toggle("show", !!visible);
      els.btnToggleMulti.textContent = visible ? "Single Stream" : "Multi-stream";
    }

    /***********************
     * BUTTONS
     ***********************/
    els.btnRetry.onclick = () => buildPlayerEmbed();
    els.btnRedirectNow.onclick = () => window.open(CONFIG.offlineRedirectUrl(currentChannel), "_blank", "noopener,noreferrer");
    els.btnOfflineAction.onclick = () => window.open(CONFIG.offlineRedirectUrl(currentChannel), "_blank", "noopener,noreferrer");

    els.btnToggleChat.onclick = () => {
      const isCollapsed = document.body.classList.contains("chat-collapsed");
      setChatVisible(isCollapsed);
    };

    els.btnToggleMulti.onclick = () => {
      const isShown = els.multistreamGrid.classList.contains("show");
      setMultiStreamVisible(!isShown);
      if (!isShown) buildMultiStreamGrid();
    };

    els.btnPopoutChat.onclick = () => {
      const parents = CONFIG.parentDomains.map(encodeURIComponent).join("&parent=");
      const url = `https://www.twitch.tv/popout/${encodeURIComponent(currentChannel)}/chat?parent=${parents}`;
      window.open(url, "_blank", "noopener,noreferrer,width=420,height=800");
    };

    /***********************
     * INIT
     ***********************/
    (function init() {
      // Intro: fade out after a moment
      setTimeout(() => els.intro.classList.add("hide"), 1400);

      // Default channel
      currentChannel = CONFIG.defaultChannel;
      els.nowChannel.textContent = currentChannel;

      // Chat
      els.chatFrame.src = buildChatUrl(currentChannel);
      setChatVisible(!!CONFIG.chatStartsVisible);

      // Multi-stream default
      setMultiStreamVisible(!!CONFIG.multiStreamStartsVisible);
      if (CONFIG.multiStreamStartsVisible) buildMultiStreamGrid();

      // Channel controls
      buildChannelControls();

      // Player
      buildPlayerEmbed();

      // Helpful hint if parentDomains is still localhost but hosted elsewhere
      if (!CONFIG.parentDomains || !CONFIG.parentDomains.length) {
        console.warn("CONFIG.parentDomains is empty — Twitch embed will fail.");
      }
    })();
  </script>
</body>
</html>
